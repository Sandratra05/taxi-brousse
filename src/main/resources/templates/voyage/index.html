<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">
<head>
    <title>Liste des voyages</title>
    <link rel="stylesheet" th:href="@{/css/sidebar.css}">
</head>
<body>

<div th:replace="fragments/sidebar :: sidebar"></div>

<div class="content">

    <h1>Liste des voyages</h1>

    <a th:href="@{/voyages/form}">Nouveau voyage</a>

    <div class="actions-buttons">
        <a th:href="@{/voyages/chiffreAffaire}" class="btn">
            <i class="fas fa-chart-line"></i> Voir Chiffre d'affaires
        </a>
    </div>

    <form action="/voyages" method="get" style="border:1px solid #ccc; padding:15px; margin-bottom:20px; background:#f9f9f9;">
        <h3>Filtrer les voyages</h3>

        <label>Trajet:
            <select name="trajetId">
                <option value="">-- Tous --</option>
                <option th:each="t : ${trajets}" 
                        th:value="${t.id}" 
                        th:text="${t.gareDepart.nom + ' → ' + t.gareArrivee.nom}"
                        th:selected="${trajetId != null && trajetId == t.id}"></option>
            </select>
        </label>
        
        <label>Chauffeur:
            <select name="chauffeurId">
                <option value="">-- Tous --</option>
                <option th:each="c : ${chauffeurs}" 
                        th:value="${c.id}" 
                        th:text="${c.nom + ' ' + c.prenom}"
                        th:selected="${chauffeurId != null && chauffeurId == c.id}"></option>
            </select>
        </label>
        
        <label>Véhicule:
            <select name="vehiculeId">
                <option value="">-- Tous --</option>
                <option th:each="v : ${vehicules}" 
                        th:value="${v.id}" 
                        th:text="${v.immatriculation}"
                        th:selected="${vehiculeId != null && vehiculeId == v.id}"></option>
            </select>
        </label>
        
        <label>Statut:
            <select name="statutId">
                <option value="">-- Tous --</option>
                <option th:each="s : ${statuts}" 
                        th:value="${s.id}"
                        th:text="${s.libelle}"
                        th:selected="${statutId != null && statutId == s.id}"></option>
            </select>
        </label>
        
        <br/>
        
        <label>Date début: 
            <input type="datetime-local" name="dateDebut" th:value="${dateDebut}"/>
        </label>
        
        <label>Date fin: 
            <input type="datetime-local" name="dateFin" th:value="${dateFin}"/>
        </label>
        
        <br/>
        
        <button type="submit">Filtrer</button>
        <a href="/voyages">Réinitialiser</a>
    </form>

    <table>
        <thead>
        <tr>
            <th>Date départ</th>
            <th>Trajet</th>
            <th>Chauffeur</th>
            <th>Véhicule</th>
            <th>Statut</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="item : ${voyagesWithStatus}">
            <td><strong th:text="${#temporals.format(item.voyage.dateDepart, 'yyyy-MM-dd HH:mm')}"></strong></td>

            <td th:text="${item.voyage.trajet != null ? (item.voyage.trajet.gareDepart.nom + ' → ' + item.voyage.trajet.gareArrivee.nom) : '-'}"></td>
            <td th:text="${item.voyage.chauffeur != null ? (item.voyage.chauffeur.nom + ' ' + item.voyage.chauffeur.prenom) : '-'}"></td>
            <td th:text="${item.voyage.vehicule != null ? item.voyage.vehicule.immatriculation : '-'}"></td>

            <td>
                <span th:if="${item.statut == 'Prévue'}" class="status-prevue" th:text="${item.statut}"></span>
                <span th:if="${item.statut == 'En cours'}" class="status-en-cours" th:text="${item.statut}"></span>
                <span th:if="${item.statut == 'Terminé'}" class="status-termine" th:text="${item.statut}"></span>
                <span th:if="${item.statut == 'Annulé'}" class="status-hors-service" th:text="${item.statut}"></span>
                <span th:if="${item.statut != 'Prévue' && item.statut != 'En cours' && item.statut != 'Terminé' && item.statut != 'Annulé'}" class="status-neutral" th:text="${item.statut}"></span>
            </td>
            <td>
                <a th:if="${item.statut == 'Prévue'}" th:href="@{/billets/voyage/{id}/acheter(id=${item.voyage.id})}"><i class="fas fa-chair"></i> Voir places</a>
                <a th:if="${item.statut == 'Prévue' || item.statut == 'En cours'}"  th:href="@{|/voyages/${item.voyage.id}/edit|}"><i class="fas fa-edit"></i> Modifier</a>
                <span th:if="${item.statut != 'Prévue' && item.statut != 'En cours'}" class="status-neutral">Aucune action</span>
            </td>
        </tr>
        <tr th:if="${#lists.isEmpty(voyages)}">
            <td colspan="7">Aucun voyage.</td>
        </tr>
        </tbody>
    </table>

</div>

</body>
</html>